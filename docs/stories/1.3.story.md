# Story 1.3: Data Layer Adaptation & Cleanup

**Epic**: WNDMNGR Modernization
**Status**: Draft
**Points**: 5

## Story Statement
**As a** Developer,
**I want** to move the data access layer to `src/data`, clean up the legacy code into a `legacy/` folder, and update the architecture docs for Oracle Cloud,
**so that** the project structure is clean, Pylance errors are resolved, and the new backend is ready for Taipy without legacy interference.

## Context & Background
We have a mix of old Streamlit files (`auth.py`, `database.py`, `DATABASE/`) and new Taipy code (`src/`). Pylance is confused. We need to migrate the database logic to `src/data` (removing Streamlit dependencies) and move *all* old files to a `legacy/` folder which will be gitignored. We also decided to switch deployment from HF Spaces to **Oracle Cloud**.

## Acceptance Criteria
1.  **New Data Layer**:
    *   `src/data/sqlite_db.py`: Implemented (pure Python, no Streamlit).
    *   `src/data/supabase_db.py`: Implemented (pure Python, no Streamlit).
    *   `src/database.py`: New Facade implemented (pure Python).
2.  **Legacy Cleanup**:
    *   `legacy/` folder created.
    *   Old files moved: `auth.py`, `database.py`, `DATABASE/`, `app_streamlit_legacy.py`, `TESTS/test_auth.py`, `TESTS/test_database.py`.
    *   `.gitignore` updated to include `legacy/`.
3.  **Architecture Update**: `docs/architecture/tech-stack.md` updated to replace "Hugging Face Spaces" with "Oracle Cloud".
4.  **State Management**: `src/state.py` created to hold global Taipy state variables.

## Technical Details

### Architecture Alignment
*   **Tech Stack**: [Source: docs/architecture/tech-stack.md]
    *   Update Hosting to **Oracle Cloud**.
*   **File Structure**:
    *   `src/data/`: Concrete DB implementations.
    *   `src/database.py`: Facade.
    *   `legacy/`: Dumpster for old code.

### Refactoring Plan
1.  **Copy & Clean**: Copy logic from `DATABASE/` to `src/data/`, removing `import streamlit` and `@st.cache_data`.
2.  **Move**: Move old files to `legacy/`.
3.  **Update Config**: Ensure `src/database.py` imports from `src.data`.

## Tasks
1.  [ ] Update `docs/architecture/tech-stack.md` (HF Spaces -> Oracle Cloud).
2.  [ ] Create `src/data/` directory.
3.  [ ] Create `src/data/sqlite_db.py` (Adapted from `DATABASE/sqlite_db.py` - Remove Streamlit).
4.  [ ] Create `src/data/supabase_db.py` (Adapted from `DATABASE/supabase_db.py` - Remove Streamlit).
5.  [ ] Create `src/database.py` (Adapted from `database.py` - Remove Streamlit).
6.  [ ] Create `src/state.py` (Define `selected_farm_uuid`, `farms_list`, etc.).
7.  [ ] Create `legacy/` directory.
8.  [ ] Move legacy files (`auth.py`, `database.py`, `DATABASE/`, `app_streamlit_legacy.py`, `TESTS/test_auth.py`, `TESTS/test_database.py`) to `legacy/`.
9.  [ ] Add `legacy/` to `.gitignore`.
10. [ ] Unit Test: Create `TESTS/test_db_facade.py` to verify `src/database.py` works (check `get_all_farms`).

## Testing Requirements
*   **Verification**: Run `TESTS/test_db_facade.py`.
*   **Cleanliness**: Verify root directory no longer has `auth.py` or `database.py`.